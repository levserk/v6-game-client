/*! v6-game-client 2014-12-12 16:34 */
!function(a,b,c){var d,e,f;!function(a){function b(a,b){return u.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return c(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var d,e=k(a),f=e[0];return a=e[1],f&&(f=c(f,b),d=j(f)),f?a=d&&d.normalize?d.normalize(a,h(b)):c(a,b):(a=c(a,b),e=k(a),f=e[0],a=e[1],f&&(d=j(f))),{f:f?f+"!"+a:a,n:a,pr:f,p:d}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},d=e=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},d._defined=q,f=function(a,c,d){c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},f.amd={jQuery:!0}}(),f("lib/almond.js",function(){}),f("require-cnf",[],function(){e.config({urlArgs:"bust="+ +new Date,baseUrl:"./",paths:{jquery:"lib/jquery-2.1.1.min",underscore:"lib/underscore-min",backbone:"lib/backbone-min",text:"lib/text",tpls:"templates",client:"modules/client",EE:"lib/EventEmitter.min","jquery-ui":"lib/jquery-ui"},shim:{backbone:{deps:["underscore","jquery"],exports:"Backbone"},"jquery-ui":{exports:"$",deps:["jquery"]},EE:{exports:"EventEmitter"}}})}),function(){function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype,e=this,g=e.EventEmitter;d.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return e.EventEmitter=g,a},"function"==typeof f&&f.amd?f("EE",[],function(){return a}):"object"==typeof module&&module.exports?module.exports=a:e.EventEmitter=a}.call(this),f("modules/game_manager",["EE"],function(a){function b(a,b){this.data=a,this.id=a.id,this.owner=b.getUser(a.owner),this.players=[];for(var c=0;c<a.players.length;c++)this.players.push(b.getUser(a.players[c]))}var c=function(a){this.client=a,this.currentRoom=null};return c.prototype=new a,c.prototype.onMessage=function(a){switch(console.log("game_manager;","message",a),a.type){case"game_start":this.onGameStart(a.data);break;case"ready":console.log("game_manager;","game user ready",a.data);break;case"round_start":console.log("game_manager;","game round start",a.data);break;case"turn":console.log("game_manager;","game turn",a.data);break;case"event":console.log("game_manager;","game event",a.data);break;case"user_leave":var b=this.getPlayer(a.data);console.log("game_manager;","user leave game",b),this.emit("user_leave",b);break;case"round_end":console.log("game_manager","round end",a.data),this.emit("round_end",a.data,this.client.getPlayer()),a.data.winner?a.data.winner==this.client.getPlayer().userId?console.log("game_manager;","win",a.data):console.log("game_manager;","lose",a.data):"not_save"==a.data.winner?console.log("game_manager","not accepted",a.data):console.log("game_manager;","draw",a.data);break;case"game_end":console.log("game_manager;","end game",this.currentRoom),this.emit("game_end",this.currentRoom),this.currentRoom=null;break;case"error":console.log("game_manager;","error",a.data)}},c.prototype.onGameStart=function(a){a=new b(a,this.client),console.log("game_manager;","game started",a),this.currentRoom=a,this.emit("game_start",a),this.sendReady()},c.prototype.onUserLeave=function(a){console.log("game_manager","user leave game",a),this.emit("user_leave",a),this.emit("game_end",this.currentRoom),this.currentRoom=null},c.prototype.leaveGame=function(){this.client.send("game_manager","leave","server",!0)},c.prototype.sendReady=function(){this.client.send("game_manager","ready","server",!0)},c.prototype.sendTurn=function(a){this.client.send("game_manager","turn","server",a)},c.prototype.getPlayer=function(a){if(this.currentRoom)for(var b=0;b<this.currentRoom.players.length;b++)if(this.currentRoom.players[b].userId==a)return this.currentRoom.players[b];return null},c}),f("modules/invite_manager",["EE"],function(a){var b=function(a){var b=this;this.client=a,this.invites={},this.invite=null,a.userList.on("leave_user",function(a){b.invite&&b.invite.target==a.userId&&(b.invite=null),b.removeInvite(a.userId)}),a.gameManager.on("game_start",function(){b.invite=null,b.rejectAll()})};return b.prototype=new a,b.prototype.onMessage=function(a){switch(console.log("invite_manager;","message",a),a.type){case"invite":this.onInvite(a.data);break;case"reject":this.onReject(a.data.target,a.data.from,"rejected");break;case"cancel":this.onCancel(a.data)}},b.prototype.onInvite=function(a){this.invites[a.from]=a,this.emit("new_invite",{from:this.client.getUser(a.from)})},b.prototype.onReject=function(a,b,c){this.invite.target==a&&this.client.getPlayer().userId==b?(this.emit("reject_invite",{user:this.client.userList.getUser(a),reason:c}),this.invite=null):console.warn("invite_manager; ","wrong user reject invite",a,b)},b.prototype.onCancel=function(a){this.invites[a.from]&&(this.emit("cancel_invite",this.invites[a.from]),this.removeInvite(a.from))},b.prototype.sendInvite=function(a,b){return a?(this.invite&&this.cancel(),b=b||{},b.target=a,this.invite=b,void this.client.send("invite_manager","invite",a,this.invite)):void console.warn("invite_manager; ","wrong userId to send invite",a)},b.prototype.accept=function(a){if(this.invites[a]){var b=this.invites[a];delete this.invites[a],this.cancel(),this.rejectAll(),this.client.send("invite_manager","accept",a,b)}},b.prototype.reject=function(a){this.invites[a]&&(this.client.send("invite_manager","reject",a,this.invites[a]),this.removeInvite(a))},b.prototype.rejectAll=function(){for(var a in this.invites)this.invites.hasOwnProperty(a)&&(this.client.send("invite_manager","reject",a,this.invites[a]),this.removeInvite(a))},b.prototype.cancel=function(){this.invite&&(this.client.send("invite_manager","cancel",this.invite.target,this.invite),this.invite=null)},b.prototype.removeInvite=function(a){console.log("invite_manger;","removeInvite",a),this.invites[a]&&(this.emit("remove_invite",this.invites[a]),delete this.invites[a])},b}),f("modules/user_list",["EE"],function(a){function b(a,b){if(!a||!a.userId||!a.userName)throw new Error("wrong user data!");this.userId=a.userId,this.userName=a.userName,this.isPlayer=b||!1}var c=function(a){var b=this;this.client=a,this.users=[],this.rooms=[],a.on("login",function(a){b.onUserLogin(a,!0)})};return c.prototype=new a,c.prototype.onMessage=function(a){switch(a.type){case"user_login":this.onUserLogin(a.data)}},c.prototype.onUserLogin=function(a,c){var d=new b(a,c);c&&(this.player=d);for(var e=0;e<this.users.length;e++)if(this.users[e].userId==d.userId)return console.warn("user_list;","user already in list!",d),!1;this.users.push(d),this.emit("new_user",d)},c.prototype.onUserLeave=function(a){for(var b=0;b<this.users.length;b++)if(this.users[b].userId==a){var c=this.users[b];return this.users.splice(b,1),void this.emit("leave_user",c)}console.warn("user_list;","no user in list",a)},c.prototype.onGameStart=function(a,b){for(var c=0;c<b.length;c++)b[c]=this.getUser(b[c]),b[c].isInRoom=!0;var d={room:a,players:b};this.rooms.push(d),this.emit("new_room",d)},c.prototype.onGameEnd=function(a,b){for(var c=0;c<this.rooms.length;c++)if(this.rooms[c].room==a){var d=this.rooms[c];this.rooms.splice(c,1);for(var e=0;e<d.players.length;e++)d.players[e].isInRoom=!1;return void this.emit("close_room",d)}console.warn("user_list;","no room in list",a,b)},c.prototype.getUser=function(a){for(var b=0;b<this.users.length;b++)if(this.users[b].userId==a)return this.users[b];return null},c.prototype.getUsers=function(){var a=this.client.inviteManager.invite;return a?_.map(this.users,function(b){return b.userId===a.target&&(b.isInvited=!0),b}):this.users},c.prototype.getUserList=function(){for(var a,b=[],c=this.client.inviteManager.invite,d=0;d<this.users.length;d++)a=this.users[d],c&&a.userId==c.target?a.isInvited=!0:delete a.isInvited,a.isInRoom||b.push(a);return b},c.prototype.getRoomList=function(){return this.rooms},c}),f("modules/socket",["EE"],function(a){var b=function(a){a=a||{},this.port=a.port||"8080",this.domain=a.domain||"localhost",this.game=a.game||"test",this.url=a.url||this.game,this.isConnecting=!0,this.isConnected=!1};return b.prototype=new a,b.prototype.init=function(){var a=this;try{this.ws=new WebSocket("ws://"+this.domain+":"+this.port+"/"+this.url),this.ws.onclose=function(b,c){console.log("socket;","ws closed",b,c),a.isConnected&&a.onDisconnect()},this.ws.onerror=function(b){a.onError(b)},this.ws.onmessage=function(b,c){console.log("socket;","ws message",b,c);try{b=JSON.parse(b.data)}catch(d){return void console.log("socket;","ws wrong data in message",d)}a.onMessage(b)},this.ws.onopen=function(){console.log("socket;",new Date,"ws open"),a.onConnect()}}catch(b){console.log("socket;","ws open error"),this.onError(b)}},b.prototype.onError=function(a){console.log("socket;","ws error",a),this.isConnecting&&(this.isConnecting=!1,console.log("socket;","ws connection failed!"),this.onConnectionFailed())},b.prototype.onConnect=function(){this.isConnected=!0,this.emit("connection")},b.prototype.onDisconnect=function(){this.isConnected=!1,this.emit("disconnection")},b.prototype.onMessage=function(a){this.emit("message",a)},b.prototype.onConnectionFailed=function(){this.isConnecting=!1,this.isConnected=!1,this.emit("failed")},b.prototype.send=function(a){try{a=JSON.stringify(a)}catch(b){return void console.warn("socket;","json stringify err",a,b)}this.ws.send(a)},b}),f("client",["modules/game_manager","modules/invite_manager","modules/user_list","modules/socket","EE"],function(a,b,c,d,e){var f=function(){var e=this;this.userList=new c(this),this.gameManager=new a(this),this.inviteManager=new b(this),this.socket=new d,this.socket.on("connection",function(){console.log("client;","socket connected")}),this.socket.on("disconnection",function(){console.log("client;","socket disconnected")}),this.socket.on("failed",function(){console.log("client;","socket connection failed")}),this.socket.on("message",function(a){console.log("client;","socket message",a),e.onMessage(a)}),this.getUser=this.userList.getUser.bind(this.userList)};return f.prototype=new e,f.prototype.init=function(){this.socket.init()},f.prototype.onMessage=function(a){switch(a.module){case"server":this.onServerMessage(a);break;case"invite_manager":this.inviteManager.onMessage(a);break;case"game_manager":this.gameManager.onMessage(a)}},f.prototype.onServerMessage=function(a){switch(a.type){case"login":this.onLogin(a.data.you,a.data.userlist,a.data.rooms);break;case"user_login":this.userList.onUserLogin(a.data);break;case"user_leave":this.userList.onUserLeave(a.data);break;case"new_game":this.userList.onGameStart(a.data.room,a.data.players);break;case"end_game":this.userList.onGameEnd(a.data.room,a.data.players)}},f.prototype.onLogin=function(a,b,c){console.log("client;","login",a,b,c),this.emit("login",a);var d;for(d=0;d<b.length;d++)this.userList.onUserLogin(b[d]);for(d=0;d<c.length;d++)this.userList.onGameStart(c[d].room,c[d].players)},f.prototype.send=function(a,b,c,d){return"object"==typeof a&&a.module&&a.type&&a.data&&(b=a.type,d=a.data,c=a.target,a=a.module),a&&b&&d&&c?("server"!=c&&(this.userList.getUser(c)||console.warn("client;","send message to offline user!",c)),void this.socket.send({module:a,type:b,target:c,data:d})):void console.warn("client;","some arguments undefined!",a,b,c,d)},f.prototype.getPlayer=function(){return this.userList.player},f}),f("text",["module"],function(a){var b,c,d,f,g,h=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,j=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,k="undefined"!=typeof location&&location.href,l=k&&location.protocol&&location.protocol.replace(/\:/,""),m=k&&location.hostname,n=k&&(location.port||void 0),o={},p=a.config&&a.config()||{};return b={version:"2.0.12",strip:function(a){if(a){a=a.replace(i,"");var b=a.match(j);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=h[b];try{a=new ActiveXObject(c)}catch(d){}if(a){h=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.indexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1,a.length)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,p.isBuild&&(o[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();p.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=p.useXhr||b.useXhr;return 0===h.indexOf("empty:")?void d():void(!k||i(h,l,m,n)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d){if(o.hasOwnProperty(c)){var e=b.jsEscape(o[c]);d.asModule(a+"!"+c,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(){var c=function(a){return e(j,a)};c.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,c,f)},f)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(c=e.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");0===e.indexOf("﻿")&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===p.env||!p.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);p.onXhr&&p.onXhr(g,a),g.onreadystatechange=function(){var b,e;4===g.readyState&&(b=g.status||0,b>399&&600>b?(e=new Error(a+" HTTP status: "+b),e.xhr=g,d&&d(e)):c(g.responseText),p.onXhrComplete&&p.onXhrComplete(g,a))},g.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,f=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),g="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,e,h,i={};g&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(f.nsIFileInputStream),c.init(h,1,0,!1),e=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(f.nsIConverterInputStream),e.init(c,"utf-8",c.available(),f.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),e.readString(c.available(),i),e.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),f("text!tpls/userListFree.ejs",[],function(){return'<% _.each(users, function(user) { %>\r\n<tr>\r\n    <td class="userName"><%= user.userName %></td>\r\n    <% if (user.isPlayer) { %>\r\n    <td></td>\r\n    <% } else if (user.isInvited) { %>\r\n    <td class="inviteBtn activeInviteBtn" data-userId="<%= user.userId %>">Отмена</td>\r\n    <% } else { %>\r\n    <td class="inviteBtn" data-userId="<%= user.userId %>">Пригласить</td>\r\n    <% } %>\r\n\r\n</tr>\r\n\r\n<% }) %>'}),f("text!tpls/userListInGame.ejs",[],function(){return'<% _.each(rooms, function(room) { %>\r\n<tr>\r\n    <td class="userName"><%= room.players[0].userName %></td>\r\n    <td class="userName"><%= room.players[1].userName %></td>\r\n</tr>\r\n<% }) %>'}),f("text!tpls/userListMain.ejs",[],function(){return'<div class="tabs">\r\n    <div data-type="free">Свободны <span></span></div>\r\n    <div data-type="inGame">Играют <span></span></div>\r\n</div>\r\n<div id="userListSearch">\r\n    <label for="userListSearch">Поиск по списку:</label><input type="text" id="userListSearch"/>\r\n</div>\r\n<div class="tableWrap">\r\n    <table class="playerList"></table>\r\n</div>\r\n\r\n<div class="btn">\r\n    <span>Играть с любым</span>\r\n</div>'}),f("views/user_list",["underscore","backbone","jquery","text!tpls/userListFree.ejs","text!tpls/userListInGame.ejs","text!tpls/userListMain.ejs"],function(a,b,c,d,e,f){var g=b.View.extend({tagName:"div",id:"userList",tplFree:a.template(d),tplInGame:a.template(e),tplMain:a.template(f),events:{"click .inviteBtn":"invitePlayer","click .tabs div":"clickTab"},clickTab:function(a){var b=c(a.currentTarget),d=b.attr("data-type");d!==this.currentActiveTabName&&(this.currentActiveTabName=d,this._setActiveTab(this.currentActiveTabName),this._showPlayerListByTabName(this.currentActiveTabName))},invitePlayer:function(a){var b=c(a.currentTarget),d=b.attr("data-userId");b.hasClass(this.ACTIVE_INVITE_CLASS)?(client.inviteManager.cancel(),b.removeClass(this.ACTIVE_INVITE_CLASS),b.html("Пригласить")):(this.$el.find("."+this.ACTIVE_INVITE_CLASS).html("Пригласить").removeClass(this.ACTIVE_INVITE_CLASS),client.inviteManager.sendInvite(d,{}),b.addClass(this.ACTIVE_INVITE_CLASS),b.html("Отмена")),console.log("invite user",d)},initialize:function(){this.$el.html(this.tplMain()),c("body").append(this.el),this.ACTIVE_INVITE_CLASS="activeInviteBtn",this.ACTIVE_TAB_CLASS="activeTab",this.$list=this.$el.find(".tableWrap table"),this.$counterFree=this.$el.find('.tabs div[data-type="free"]').find("span"),this.$counterinGame=this.$el.find('.tabs div[data-type="inGame"]').find("span"),this.listenTo(client.userList,"new_user",this.render.bind(this)),this.listenTo(client.userList,"leave_user",this.render.bind(this)),this.listenTo(client.inviteManager,"reject_invite",this.onRejectInvite.bind(this)),this.listenTo(client.userList,"new_room",this.render.bind(this)),this.listenTo(client.userList,"close_room",this.render.bind(this)),this.currentActiveTabName="free",this._setActiveTab(this.currentActiveTabName)},_setActiveTab:function(a){this.$el.find(".tabs div").removeClass(this.ACTIVE_TAB_CLASS),this.$el.find('.tabs div[data-type="'+a+'"]').addClass(this.ACTIVE_TAB_CLASS)},_setCounters:function(){this.$counterFree.html("("+client.userList.getUserList().length+")"),this.$counterinGame.html("("+2*client.userList.getRoomList().length+")")},_showPlayerListByTabName:function(a){void 0===a&&(a=this.currentActiveTabName),"free"===a?this.$list.html(this.tplFree({users:client.userList.getUserList()})):"inGame"===a?this.$list.html(this.tplInGame({rooms:client.userList.getRoomList()})):console.warn("unknown tab",a)},onRejectInvite:function(a){this.$el.find("."+this.ACTIVE_INVITE_CLASS+'[data-userId="'+a.user.userId+'"]').html("Пригласить").removeClass(this.ACTIVE_INVITE_CLASS)},render:function(){return this._showPlayerListByTabName(),this._setCounters(),this}});return g}),f("views/dialogs",[],function(){var a=function(){function a(){client.inviteManager.on("new_invite",b),client.inviteManager.on("reject_invite",c),client.inviteManager.on("cancel_invite",d),client.inviteManager.on("remove_invite",e)}function b(a){var b=$("<div>");b.addClass(f),b.attr("data-userId",a.from.userId),b.html("Вас пригласил в игру пользователь "+a.from.userName).dialog({resizable:!1,modal:!1,buttons:{"Принять":function(){client.inviteManager.accept($(this).attr("data-userId")),$(this).remove()},"Отклонить":function(){client.inviteManager.reject($(this).attr("data-userId")),this.remove()}},close:function(){client.inviteManager.reject($(this).attr("data-userId")),this.remove()}})}function c(a){var b=$("<div>");b.addClass(f),b.html("Пользователь "+a.user.userName+" отклонил ваше приглашение").dialog({resizable:!1,modal:!0,buttons:{"Ок":function(){$(this).dialog("close"),this.remove()}}})}function d(a){console.log("cancel invite",a)}function e(a){var b=a.from;console.log("remove invite",b),$("."+f+'[data-userId="'+b+'"]').remove()}var f="dialogInvite";return{init:a}}();return a}),e(["require-cnf"],function(){e(["jquery-ui"],function(){e(["client","views/user_list","views/dialogs"],function(a,b,c){function d(){var a=$("<div>");a.attr("id","endGameButton"),a.html("<span>Выйти из игры</span>"),a.on("click",function(){client.gameManager.leaveGame()}),$("body").append(a)}function e(){new b,c.init()}console.log("main;",new Date,"ready"),document.cookie="userId="+Math.floor(1e5*Math.random())+"; path=/;",window.client=new a({domain:"localhost"}),client.init(),d(),e()})})}),f("main.js",function(){}),f("jquery",function(){return a}),f("jquery-ui",function(){return a}),f("underscore",function(){return b}),f("backbone",function(){return c})}($,_,Backbone);